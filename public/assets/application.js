
(function(exports){var io=exports;io.version='0.7.3';io.protocol=1;io.transports=[];io.j=[];io.sockets={};io.connect=function(host,details){var uri=io.util.parseUri(host),uuri,socket;if('undefined'!=typeof document){uri.host=uri.host||document.domain;uri.port=uri.port||document.location.port;}
uuri=io.util.uniqueUri(uri);var options={host:uri.host,secure:uri.protocol=='https',port:uri.port||80};io.util.merge(options,details);if(options['force new connection']||!io.sockets[uuri]){socket=new io.Socket(options);}
if(!options['force new connection']&&socket){io.sockets[uuri]=socket;}
socket=socket||io.sockets[uuri];return socket.of(uri.path.length>1?uri.path:'');};})('object'===typeof module?module.exports:(window.io={}));(function(exports){var util=exports.util={};var re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'];util.parseUri=function(str){var m=re.exec(str||''),uri={},i=14;while(i--){uri[parts[i]]=m[i]||'';}
return uri;};util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;if('undefined'!=typeof document){host=host||document.domain;port=port||(protocol=='https'&&document.location.protocol!=='https:'?443:document.location.port);}else{host=host||'localhost';if(!port&&protocol=='https'){port=443;}}
return(protocol||'http')+'://'+host+':'+(port||80);};var pageLoaded=false;util.load=function(fn){if(document.readyState==='complete'||pageLoaded){return fn();}
util.on(window,'load',fn,false);};util.on=function(element,event,fn,capture){if(element.attachEvent){element.attachEvent('on'+event,fn);}else{element.addEventListener(event,fn,capture);}};util.request=function(xdomain){if('undefined'!=typeof window){if(xdomain&&window.XDomainRequest){return new XDomainRequest();};if(window.XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest();};if(!xdomain){try{return new window.ActiveXObject('Microsoft.XMLHTTP');}catch(e){}}}
return null;};if('undefined'!=typeof window){util.load(function(){pageLoaded=true;});}
util.defer=function(fn){if(!util.ua.webkit){return fn();}
util.load(function(){setTimeout(fn,100);});};util.merge=function merge(target,additional,deep,lastseen){var seen=lastseen||[],depth=typeof deep=='undefined'?2:deep,prop;for(prop in additional){if(additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0){if(typeof target[prop]!=='object'||!depth){target[prop]=additional[prop];seen.push(additional[prop]);}else{util.merge(target[prop],additional[prop],depth-1,seen);}}}
return target;};util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype);};util.inherit=function(ctor,ctor2){ctor.prototype=new ctor2;util.merge(ctor,ctor2);};util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==='[object Array]';};util.intersect=function(arr,arr2){var ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr
for(var i=0,l=shortest.length;i<l;i++){if(~util.indexOf(longest,shortest[i]))
ret.push(shortest[i]);}
return ret;}
util.indexOf=function(arr,o,i){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(arr,o,i);}
for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++);return j<=i?-1:i;};util.toArray=function(enu){var arr=[];for(var i=0,l=enu.length;i<l;i++)
arr.push(enu[i]);return arr;};util.ua={};util.ua.hasCORS='undefined'!=typeof window&&window.XMLHttpRequest&&(function(){try{var a=new XMLHttpRequest();}catch(e){return false;}
return a.withCredentials!=undefined;})();util.ua.webkit='undefined'!=typeof navigator&&/webkit/i.test(navigator.userAgent);})('undefined'!=typeof window?io:module.exports);(function(exports,io){exports.EventEmitter=EventEmitter;function EventEmitter(){};EventEmitter.prototype.on=function(name,fn){if(!this.$events){this.$events={};}
if(!this.$events[name]){this.$events[name]=fn;}else if(io.util.isArray(this.$events[name])){this.$events[name].push(fn);}else{this.$events[name]=[this.$events[name],fn];}
return this;};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.once=function(name,fn){var self=this;function on(){self.removeListener(name,on);fn.apply(this,arguments);};on.listener=fn;this.on(name,on);return this;};EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(io.util.isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++){if(list[i]===fn||(list[i].listener&&list[i].listener===fn)){pos=i;break;}}
if(pos<0){return this;}
list.splice(pos,1);if(!list.length){delete this.$events[name];}}else if(list===fn||(list.listener&&list.listener===fn)){delete this.$events[name];}}
return this;};EventEmitter.prototype.removeAllListeners=function(name){if(this.$events&&this.$events[name]){this.$events[name]=null;}
return this;};EventEmitter.prototype.listeners=function(name){if(!this.$events){this.$events={};}
if(!this.$events[name]){this.$events[name]=[];}
if(!io.util.isArray(this.$events[name])){this.$events[name]=[this.$events[name]];}
return this.$events[name];};EventEmitter.prototype.emit=function(name){if(!this.$events){return false;}
var handler=this.$events[name];if(!handler){return false;}
var args=Array.prototype.slice.call(arguments,1);if('function'==typeof handler){handler.apply(this,args);}else if(io.util.isArray(handler)){var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args);}}else{return false;}
return true;};})('undefined'!=typeof io?io:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse){return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}}
var JSON=exports.JSON={};function f(n){return n<10?'0'+n:n;}
function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+'-'+
f(d.getUTCMonth()+1)+'-'+
f(d.getUTCDate())+'T'+
f(d.getUTCHours())+':'+
f(d.getUTCMinutes())+':'+
f(d.getUTCSeconds())+'Z':null;};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=date(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};})('undefined'!=typeof io?io:module.exports,typeof JSON!=='undefined'?JSON:undefined);(function(exports,io){var parser=exports.parser={};var packets=parser.packets=['disconnect','connect','heartbeat','message','json','event','ack','error','noop'];var reasons=parser.reasons=['transport not supported','client not handshaken','unauthorized'];var advice=parser.advice=['reconnect'];var JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var type=indexOf(packets,packet.type),id=packet.id||'',endpoint=packet.endpoint||'',ack=packet.ack,data=null;switch(packet.type){case'error':var reason=packet.reason?indexOf(reasons,packet.reason):'',adv=packet.advice?indexOf(advice,packet.advice):''if(reason!==''||adv!=='')
data=reason+(adv!==''?('+'+adv):'')
break;case'message':if(packet.data!=='')
data=packet.data;break;case'event':var ev={name:packet.name};if(packet.args&&packet.args.length){ev.args=packet.args;}
data=JSON.stringify(ev);break;case'json':data=JSON.stringify(packet.data);break;case'connect':if(packet.qs)
data=packet.qs;break;case'ack':data=packet.ackId
+(packet.args&&packet.args.length?'+'+JSON.stringify(packet.args):'');break;}
var encoded=[type,id+(ack=='data'?'+':''),endpoint];if(data!==null&&data!==undefined)
encoded.push(data);return encoded.join(':');};parser.encodePayload=function(packets){var decoded='';if(packets.length==1)
return packets[0];for(var i=0,l=packets.length;i<l;i++){var packet=packets[i];decoded+='\ufffd'+packet.length+'\ufffd'+packets[i]}
return decoded;};var regexp=/^([^:]+):([0-9]+)?(\+)?:([^:]+)?:?(.*)?$/;parser.decodePacket=function(data){var pieces=data.match(regexp);if(!pieces)return{};var id=pieces[2]||'',data=pieces[5]||'',packet={type:packets[pieces[1]],endpoint:pieces[4]||''};if(id){packet.id=id;if(pieces[3])
packet.ack='data';else
packet.ack=true;}
switch(packet.type){case'error':var pieces=data.split('+');packet.reason=reasons[pieces[0]]||'';packet.advice=advice[pieces[1]]||'';break;case'message':packet.data=data||'';break;case'event':try{var opts=JSON.parse(data);packet.name=opts.name;packet.args=opts.args;}catch(e){}
packet.args=packet.args||[];break;case'json':try{packet.data=JSON.parse(data);}catch(e){}
break;case'connect':packet.qs=data||'';break;case'ack':var pieces=data.match(/^([0-9]+)(\+)?(.*)/);if(pieces){packet.ackId=pieces[1];packet.args=[];if(pieces[3]){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[];}catch(e){}}}
break;case'disconnect':case'heartbeat':break;};return packet;};parser.decodePayload=function(data){if(data[0]=='\ufffd'){var ret=[];for(var i=1,length='';i<data.length;i++){if(data[i]=='\ufffd'){ret.push(parser.decodePacket(data.substr(i+1).substr(0,length)));i+=Number(length)+1;length='';}else{length+=data[i];}}
return ret;}else{return[parser.decodePacket(data)];}};})('undefined'!=typeof io?io:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.Transport=Transport;function Transport(socket,sessid){this.socket=socket;this.sessid=sessid;};io.util.mixin(Transport,io.EventEmitter);Transport.prototype.onData=function(data){this.clearCloseTimeout();this.setCloseTimeout();if(data!==''){var msgs=io.parser.decodePayload(data);if(msgs&&msgs.length){for(var i=0,l=msgs.length;i<l;i++){this.onPacket(msgs[i]);}}}
return this;};Transport.prototype.onPacket=function(packet){if(packet.type=='heartbeat'){return this.onHeartbeat();}
if(packet.type=='connect'&&packet.endpoint==''){this.onConnect();}
this.socket.onPacket(packet);return this;};Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect();},this.socket.closeTimeout);}};Transport.prototype.onDisconnect=function(){if(this.close)this.close();this.clearTimeouts();this.socket.onDisconnect();return this;};Transport.prototype.onConnect=function(){this.socket.onConnect();return this;}
Transport.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null;}};Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout){clearTimeout(this.reopenTimeout);}};Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet));};Transport.prototype.onHeartbeat=function(heartbeat){this.packet({type:'heartbeat'});};Transport.prototype.onOpen=function(){this.open=true;this.clearCloseTimeout();this.socket.onOpen();};Transport.prototype.onClose=function(){var self=this;this.open=false;this.setCloseTimeout();this.socket.onClose();};Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+'://'+options.host+':'+options.port+'/'+options.resource+'/'+io.protocol
+'/'+this.name+'/'+this.sessid;};})('undefined'!=typeof io?io:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.Socket=Socket;function Socket(options){this.options={port:80,secure:false,document:document,resource:'socket.io',transports:io.transports,'connect timeout':10000,'try multiple transports':true,'reconnect':true,'reconnection delay':500,'reopen delay':3000,'max reconnection attempts':10,'sync disconnect on unload':true,'auto connect':true};io.util.merge(this.options,options);this.connected=false;this.open=false;this.connecting=false;this.reconnecting=false;this.namespaces={};this.buffer=[];this.doBuffer=false;if(this.options['sync disconnect on unload']&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(window,'beforeunload',function(){self.disconnectSync();},false);}
if(this.options['auto connect']){this.connect();}};io.util.mixin(Socket,io.EventEmitter);Socket.prototype.of=function(name){if(!this.namespaces[name]){this.namespaces[name]=new io.SocketNamespace(this,name);if(name!==''){this.namespaces[name].packet({type:'connect'});}}
return this.namespaces[name];};Socket.prototype.publish=function(){this.emit.apply(this,arguments);var nsp;for(var i in this.namespaces){if(this.namespaces.hasOwnProperty(i)){nsp=this.of(i);nsp.$emit.apply(nsp,arguments);}}};function empty(){};Socket.prototype.handshake=function(fn){var self=this,options=this.options;function complete(data){if(data instanceof Error){self.onError(data.message);}else{fn.apply(null,data.split(':'));}};var url=['http'+(options.secure?'s':'')+':/',options.host+':'+options.port,this.options.resource,io.protocol,'?t='++new Date].join('/');if(this.isXDomain()){var insertAt=document.getElementsByTagName('script')[0],script=document.createElement('SCRIPT');script.src=url+'&jsonp='+io.j.length;insertAt.parentNode.insertBefore(script,insertAt);io.j.push(function(data){complete(data);script.parentNode.removeChild(script);});}else{var xhr=io.util.request();xhr.open('GET',url);xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;if(xhr.status==200){complete(xhr.responseText);}else{!self.reconnecting&&self.onError(xhr.responseText);}}};xhr.send(null);}};Socket.prototype.getTransport=function(override){var transports=override||this.transports,match;for(var i=0,transport;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck())){return new io.Transport[transport](this,this.sessionid);}}
return null;};Socket.prototype.connect=function(fn){if(this.connecting){return this;}
var self=this;this.handshake(function(sid,heartbeat,close,transports){self.sessionid=sid;self.closeTimeout=close*1000;self.heartbeatTimeout=heartbeat*1000;self.transports=io.util.intersect(transports.split(','),self.options.transports);self.transport=self.getTransport();if(!self.transport){return;}
self.connecting=true;self.publish('connecting',self.transport.name);self.transport.open();if(self.options.connectTimeout){self.connectTimeoutTimer=setTimeout(function(){if(!self.connected){if(self.options['try multiple transports']){if(!self.remainingTransports){self.remainingTransports=self.transports.slice(0);}
var transports=self.remainingTransports;while(transports.length>0&&transports.splice(0,1)[0]!=self.transport.name){}
if(transports.length){self.transport=self.getTransport(transports);self.connect();}}
if(!self.remainingTransports||self.remainingTransports.length==0){self.publish('connect_failed');}}
if(self.remainingTransports&&self.remainingTransports.length==0){delete self.remainingTransports;}},self.options['connect timeout']);}
if(fn&&typeof fn=='function'){self.once('connect',fn);}});return this;};Socket.prototype.packet=function(data){if(this.connected&&!this.doBuffer){this.transport.packet(data);}else{this.buffer.push(data);}
return this;};Socket.prototype.setBuffer=function(v){this.doBuffer=v;if(!v&&this.connected&&this.buffer.length){this.transport.payload(this.buffer);this.buffer=[];}};Socket.prototype.disconnect=function(){if(this.connected){if(this.open){this.of('').packet({type:'disconnect'});}
this.onDisconnect('booted');}
return this;};Socket.prototype.disconnectSync=function(){var xhr=io.util.request(),uri=this.resource+'/'+io.protocol+'/'+this.sessionid;xhr.open('GET',uri,true);this.onDisconnect('booted');};Socket.prototype.isXDomain=function(){var locPort=window.location.port||80;return this.options.host!==document.domain||this.options.port!=locPort;};Socket.prototype.onConnect=function(){this.connected=true;this.connecting=false;if(!this.doBuffer){this.setBuffer(false);}
this.emit('connect');};Socket.prototype.onOpen=function(){this.open=true;};Socket.prototype.onClose=function(){this.open=false;};Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet);};Socket.prototype.onError=function(err){if(err&&err.advice){if(err.advice==='reconnect'){this.disconnect();this.reconnect();}}
this.publish('error',err&&err.reason?err.reason:err);};Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected;this.connected=false;this.connecting=false;this.open=false;if(wasConnected){this.transport.close();this.transport.clearTimeouts();this.publish('disconnect',reason);if('booted'!=reason&&this.options.reconnect&&!this.reconnecting){this.reconnect();}}};Socket.prototype.reconnect=function(){this.reconnecting=true;this.reconnectionAttempts=0;this.reconnectionDelay=this.options['reconnection delay'];var self=this,maxAttempts=this.options['max reconnection attempts'],tryMultiple=this.options['try multiple transports']
function reset(){if(self.connected){self.publish('reconnect',self.transport.name,self.reconnectionAttempts);}
self.removeListener('connect_failed',maybeReconnect);self.removeListener('connect',maybeReconnect);self.reconnecting=false;delete self.reconnectionAttempts;delete self.reconnectionDelay;delete self.reconnectionTimer;delete self.redoTransports;self.options['try multiple transports']=tryMultiple;};function maybeReconnect(){if(!self.reconnecting){return;}
if(self.connected){return reset();};if(self.connecting&&self.reconnecting){return self.reconnectionTimer=setTimeout(maybeReconnect,1000);}
if(self.reconnectionAttempts++>=maxAttempts){if(!self.redoTransports){self.on('connect_failed',maybeReconnect);self.options['try multiple transports']=true;self.transport=self.getTransport();self.redoTransports=true;self.connect();}else{self.publish('reconnect_failed');reset();}}else{self.reconnectionDelay*=2;self.connect();self.publish('reconnecting',self.reconnectionDelay,self.reconnectionAttempts);self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay);}};this.options['try multiple transports']=false;this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay);this.on('connect',maybeReconnect);};})('undefined'!=typeof io?io:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.SocketNamespace=SocketNamespace;function SocketNamespace(socket,name){this.socket=socket;this.name=name||'';this.flags={};this.json=new Flag(this,'json');this.ackPackets=0;this.acks={};};io.util.mixin(SocketNamespace,io.EventEmitter);SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit;SocketNamespace.prototype.packet=function(packet){packet.endpoint=this.name;this.socket.packet(packet);this.flags={};return this;};SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?'json':'message',data:data};if('function'==typeof fn){packet.id=++this.ackPackets;packet.ack=true;this.acks[packet.id]=fn;}
return this.packet(packet);};SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:'event',name:name};if('function'==typeof lastArg){packet.id=++this.ackPackets;packet.ack='data';this.acks[packet.id]=lastArg;args=args.slice(0,args.length-1);}
packet.args=args;return this.packet(packet);};SocketNamespace.prototype.disconnect=function(){if(this.name===''){this.socket.disconnect();}else{this.packet({type:'disconnect'});this.$emit('disconnect');}
return this;};SocketNamespace.prototype.onPacket=function(packet){var self=this;function ack(){self.packet({type:'ack',args:io.util.toArray(arguments),ackId:packet.id});};switch(packet.type){case'connect':this.$emit('connect');break;case'disconnect':if(this.name===''){this.socket.onDisconnect(packet.reason||'booted');}else{this.$emit('disconnect',packet.reason);}
break;case'message':case'json':var params=['message',packet.data];if(packet.ack=='data'){params.push(ack);}else if(packet.ack){this.packet({type:'ack',ackId:packet.id});}
this.$emit.apply(this,params);break;case'event':var params=[packet.name].concat(packet.args);if(packet.ack=='data')
params.push(ack);this.$emit.apply(this,params);break;case'ack':if(this.acks[packet.ackId]){this.acks[packet.ackId].apply(this,packet.args);delete this.acks[packet.ackId];}
break;case'error':if(packet.advice){this.socket.onError(packet);}else{if(packet.reason=='unauthorized'){this.$emit('connect_failed',packet.reason);}else{this.$emit('error',packet.reason);}}
break;}};function Flag(nsp,name){this.namespace=nsp;this.name=name;};Flag.prototype.send=function(){this.namespace.flags[this.name]=true;this.namespace.send.apply(this.namespace,arguments);};Flag.prototype.emit=function(){this.namespace.flags[this.name]=true;this.namespace.emit.apply(this.namespace,arguments);};})('undefined'!=typeof io?io:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.websocket=WS;function WS(socket){io.Transport.apply(this,arguments);};io.util.inherit(WS,io.Transport);WS.prototype.name='websocket';WS.prototype.open=function(){this.websocket=new WebSocket(this.prepareUrl());var self=this;this.websocket.onopen=function(){self.onOpen();self.socket.setBuffer(false);};this.websocket.onmessage=function(ev){self.onData(ev.data);};this.websocket.onclose=function(){self.onClose();self.socket.setBuffer(true);};this.websocket.onerror=function(e){self.onError(e);};return this;};WS.prototype.send=function(data){this.websocket.send(data);return this;};WS.prototype.payload=function(arr){for(var i=0,l=arr.length;i<l;i++){this.packet(arr[i]);}
return this;};WS.prototype.close=function(){this.websocket.close();return this;};WS.prototype.onError=function(e){this.socket.onError(e);};WS.prototype.scheme=function(){return this.socket.options.secure?'wss':'ws';};WS.check=function(){return'WebSocket'in window&&!('__addTask'in WebSocket);};WS.xdomainCheck=function(){return true;};io.transports.push('websocket');})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.flashsocket=Flashsocket;function Flashsocket(){io.Transport.websocket.apply(this,arguments);};io.util.inherit(Flashsocket,io.Transport.websocket);Flashsocket.prototype.name='flashsocket';Flashsocket.prototype.open=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.open.apply(self,args);});return this;};Flashsocket.prototype.send=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(self,args);});return this;};Flashsocket.prototype.close=function(){WebSocket.__tasks.length=0;io.Transport.websocket.prototype.close.call(this);return this;};Flashsocket.check=function(socket){if(typeof WebSocket=='undefined'||!('__initialize'in WebSocket)||!swfobject)return false;var supported=swfobject.getFlashPlayerVersion().major>=10,options=socket.options,path=['http'+(options.secure?'s':'')+':/',options.host+':'+options.port,options.resource,'static/flashsocket','WebSocketMain'+(socket.isXDomain()?'Insecure':'')+'.swf'];if(supported&&!Flashsocket.loaded){if(typeof WEB_SOCKET_SWF_LOCATION==='undefined'){WEB_SOCKET_SWF_LOCATION=path.join('/');}
WebSocket.__initialize();Flashsocket.loaded=true;}
return supported;};Flashsocket.xdomainCheck=function(){return true;};if(typeof window!='undefined'){WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true;}
io.transports.push('flashsocket');})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();(function(){if(window.WebSocket)return;var console=window.console;if(!console||!console.log||!console.error){console={log:function(){},error:function(){}};}
if(!swfobject.hasFlashPlayerVersion("10.0.0")){console.error("Flash Player >= 10.0.0 is required.");return;}
if(location.protocol=="file:"){console.error("WARNING: web-socket-js doesn't work in file:///... URL "+"unless you set Flash Security Settings properly. "+"Open the page via Web server i.e. http://...");}
WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++;WebSocket.__instances[self.__id]=self;self.readyState=WebSocket.CONNECTING;self.bufferedAmount=0;self.__events={};if(!protocols){protocols=[];}else if(typeof protocols=="string"){protocols=[protocols];}
setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null);});},0);};WebSocket.prototype.send=function(data){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established";}
var result=WebSocket.__flash.send(this.__id,encodeURIComponent(data));if(result<0){return true;}else{this.bufferedAmount+=result;return false;}};WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return;}
this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id);};WebSocket.prototype.addEventListener=function(type,listener,useCapture){if(!(type in this.__events)){this.__events[type]=[];}
this.__events[type].push(listener);};WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(!(type in this.__events))return;var events=this.__events[type];for(var i=events.length-1;i>=0;--i){if(events[i]===listener){events.splice(i,1);break;}}};WebSocket.prototype.dispatchEvent=function(event){var events=this.__events[event.type]||[];for(var i=0;i<events.length;++i){events[i](event);}
var handler=this["on"+event.type];if(handler)handler(event);};WebSocket.prototype.__handleEvent=function(flashEvent){if("readyState"in flashEvent){this.readyState=flashEvent.readyState;}
if("protocol"in flashEvent){this.protocol=flashEvent.protocol;}
var jsEvent;if(flashEvent.type=="open"||flashEvent.type=="error"){jsEvent=this.__createSimpleEvent(flashEvent.type);}else if(flashEvent.type=="close"){jsEvent=this.__createSimpleEvent("close");}else if(flashEvent.type=="message"){var data=decodeURIComponent(flashEvent.message);jsEvent=this.__createMessageEvent("message",data);}else{throw"unknown event type: "+flashEvent.type;}
this.dispatchEvent(jsEvent);};WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");event.initEvent(type,false,false);return event;}else{return{type:type,bubbles:false,cancelable:false};}};WebSocket.prototype.__createMessageEvent=function(type,data){if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");event.initMessageEvent("message",false,false,data,null,null,window,null);return event;}else{return{type:type,data:data,bubbles:false,cancelable:false};}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url);});};WebSocket.__initialize=function(){if(WebSocket.__flash)return;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;}
if(!window.WEB_SOCKET_SWF_LOCATION){console.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return;}
var container=document.createElement("div");container.id="webSocketContainer";container.style.position="absolute";if(WebSocket.__isFlashLite()){container.style.left="0px";container.style.top="0px";}else{container.style.left="-100px";container.style.top="-100px";}
var holder=document.createElement("div");holder.id="webSocketFlash";container.appendChild(holder);document.body.appendChild(container);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(e){if(!e.success){console.error("[WebSocket] swfobject.embedSWF failed");}});};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i){WebSocket.__tasks[i]();}
WebSocket.__tasks=[];},0);};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var events=WebSocket.__flash.receiveEvents();for(var i=0;i<events.length;++i){WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i]);}}catch(e){console.error(e);}},0);return true;};WebSocket.__log=function(message){console.log(decodeURIComponent(message));};WebSocket.__error=function(message){console.error(decodeURIComponent(message));};WebSocket.__addTask=function(task){if(WebSocket.__flash){task();}else{WebSocket.__tasks.push(task);}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false;}
var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!mimeType||!mimeType.enabledPlugin||!mimeType.enabledPlugin.filename){return false;}
return mimeType.enabledPlugin.filename.match(/flashlite/i)?true:false;};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){if(window.addEventListener){window.addEventListener("load",function(){WebSocket.__initialize();},false);}else{window.attachEvent("onload",function(){WebSocket.__initialize();});}}})();(function(exports,io){exports.XHR=XHR;function XHR(socket){if(!socket)return;io.Transport.apply(this,arguments);this.sendBuffer=[];};io.util.inherit(XHR,io.Transport);XHR.prototype.open=function(){this.socket.setBuffer(false);this.onOpen();this.get();this.setCloseTimeout();return this;};XHR.prototype.payload=function(payload){var msgs=[];for(var i=0,l=payload.length;i<l;i++){msgs.push(io.parser.encodePacket(payload[i]));}
this.send(io.parser.encodePayload(msgs));};XHR.prototype.send=function(data){this.post(data);return this;};function empty(){};XHR.prototype.post=function(data){var self=this;this.socket.setBuffer(true);function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;self.posting=false;if(this.status==200){self.socket.setBuffer(false);}else{self.onClose();}}}
function onload(){this.onload=empty;self.socket.setBuffer(false);};this.sendXHR=this.request('POST');if(window.XDomainRequest&&this.sendXHR instanceof XDomainRequest){this.sendXHR.onload=this.sendXHR.onerror=onload;}else{this.sendXHR.onreadystatechange=stateChange;}
this.sendXHR.send(data);};XHR.prototype.close=function(){this.onClose();return this;};XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain());req.open(method||'GET',this.prepareUrl()+'?t'+(+new Date));if(method=='POST'){try{if(req.setRequestHeader){req.setRequestHeader('Content-type','text/plain;charset=UTF-8');}else{req.contentType='text/plain';}}catch(e){}}
return req;};XHR.prototype.scheme=function(){return this.socket.options.secure?'https':'http';};XHR.check=function(socket,xdomain){try{if(io.util.request(xdomain)){return true;}}catch(e){}
return false;};XHR.xdomainCheck=function(){return XHR.check(null,true);};})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports.htmlfile=HTMLFile;function HTMLFile(socket){io.Transport.XHR.apply(this,arguments);};io.util.inherit(HTMLFile,io.Transport.XHR);HTMLFile.prototype.name='htmlfile';HTMLFile.prototype.get=function(){this.doc=new ActiveXObject('htmlfile');this.doc.open();this.doc.write('<html></html>');this.doc.close();this.doc.parentWindow.s=this;var iframeC=this.doc.createElement('div');iframeC.className='socketio';this.doc.body.appendChild(iframeC);this.iframe=this.doc.createElement('iframe');iframeC.appendChild(this.iframe);this.iframe.src=this.prepareUrl()+'/?t='+(+new Date);var self=this;io.util.on(window,'unload',function(){self.destroy();});};HTMLFile.prototype._=function(data,doc){this.onData(data);try{var script=doc.getElementsByTagName('script')[0];script.parentNode.removeChild(script);}catch(e){}};HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src='about:blank';}catch(e){}
this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage();}};HTMLFile.prototype.close=function(){this.destroy();return io.Transport.XHR.prototype.close.call(this);};HTMLFile.check=function(){if('ActiveXObject'in window){try{var a=new ActiveXObject('htmlfile');return a&&io.Transport.XHR.check();}catch(e){}}
return false;};HTMLFile.xdomainCheck=function(){return false;};io.transports.push('htmlfile');})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports['xhr-polling']=XHRPolling;function XHRPolling(){io.Transport.XHR.apply(this,arguments);};io.util.inherit(XHRPolling,io.Transport.XHR);XHRPolling.prototype.name='xhr-polling';XHRPolling.prototype.open=function(){var self=this;io.util.defer(function(){io.Transport.XHR.prototype.open.call(self);});return false;};function empty(){};XHRPolling.prototype.get=function(){if(!this.open)return;var self=this;function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;if(this.status==200){self.onData(this.responseText);self.get();}else{self.onClose();}}};function onload(){this.onload=empty;self.onData(this.responseText);self.get();};this.xhr=this.request();if(window.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=this.xhr.onerror=onload;}else{this.xhr.onreadystatechange=stateChange;}
this.xhr.send(null);};XHRPolling.prototype.onClose=function(){io.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=empty;try{this.xhr.abort();}catch(e){}
this.xhr=null;}};io.transports.push('xhr-polling');})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(exports,io){exports['jsonp-polling']=JSONPPolling;function JSONPPolling(socket){io.Transport['xhr-polling'].apply(this,arguments);this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg);});};io.util.inherit(JSONPPolling,io.Transport['xhr-polling']);JSONPPolling.prototype.name='jsonp-polling';JSONPPolling.prototype.post=function(data){var self=this;if(!this.form){var form=document.createElement('FORM'),area=document.createElement('TEXTAREA'),id=this.iframeId='socketio_iframe_'+this.index,iframe;form.className='socketio';form.style.position='absolute';form.style.top='-1000px';form.style.left='-1000px';form.target=id;form.method='POST';area.name='d';form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area;}
this.form.action=this.prepareUrl()+'?t='+(+new Date)+'&i='+this.index;function complete(){initIframe();self.socket.setBuffer(false);};function initIframe(){if(self.iframe){self.form.removeChild(self.iframe);}
try{iframe=document.createElement('<iframe name="'+self.iframeId+'">');}catch(e){iframe=document.createElement('iframe');iframe.name=self.iframeId;}
iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe;};initIframe();this.area.value=data;try{this.form.submit();}catch(e){}
if(this.iframe.attachEvent){iframe.onreadystatechange=function(){if(self.iframe.readyState=='complete'){complete();}};}else{this.iframe.onload=complete;}};JSONPPolling.prototype.get=function(){var self=this,script=document.createElement('SCRIPT');if(this.script){this.script.parentNode.removeChild(this.script);this.script=null;}
script.async=true;script.src=this.prepareUrl()+'/?t='+(+new Date)+'&i='+this.index;script.onerror=function(){self.onClose();};var insertAt=document.getElementsByTagName('script')[0]
insertAt.parentNode.insertBefore(script,insertAt);this.script=script;};JSONPPolling.prototype._=function(msg){this.onData(msg);if(this.open){this.get();}
return this;};JSONPPolling.check=function(){return true;};JSONPPolling.xdomainCheck=function(){return true;};io.transports.push('jsonp-polling');})('undefined'!=typeof io?io.Transport:module.exports,'undefined'!=typeof io?io:module.parent.exports);(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof module!=='undefined'&&module.exports){module.exports=_;_._=_;}else{root._=_;}
_.VERSION='1.1.6';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(_.isNumber(obj.length)){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(hasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=memo!==void 0;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial&&index===0){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return memo!==void 0?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=(_.isArray(obj)?obj.slice():_.toArray(obj)).reverse();return _.reduce(reversed,iterator,memo,context);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result=iterator.call(context,value,index,list))return breaker;});return result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;any(obj,function(value){if(found=value===target)return true;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(method.call?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.max.apply(Math,obj);var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.min.apply(Math,obj);var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.sortBy=function(obj,iterator,context){return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}),'value');};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();if(_.isArray(iterable))return iterable;if(_.isArguments(iterable))return slice.call(iterable);return _.values(iterable);};_.size=function(obj){return _.toArray(obj).length;};_.first=_.head=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.last=function(array){return array[array.length-1];};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){var values=slice.call(arguments,1);return _.filter(array,function(value){return!_.include(values,value);});};_.uniq=_.unique=function(array,isSorted){return _.reduce(array,function(memo,el,i){if(0==i||(isSorted===true?_.last(memo)!=el:!_.include(memo,el)))memo[memo.length]=el;return memo;},[]);};_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};_.bind=function(func,obj){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return hasOwnProperty.call(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(func,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};var limit=function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args);};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait);};};_.throttle=function(func,wait){return limit(func,wait,false);};_.debounce=function(func,wait){return limit(func,wait,true);};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments));return wrapper.apply(this,args);};};_.compose=function(){var funcs=slice.call(arguments);return function(){var args=slice.call(arguments);for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(hasOwnProperty.call(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){return _.filter(_.keys(obj),function(key){return _.isFunction(obj[key]);}).sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(source[prop]!==void 0)obj[prop]=source[prop];}});return obj;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};_.isEqual=function(a,b){if(a===b)return true;var atype=typeof(a),btype=typeof(b);if(atype!=btype)return false;if(a==b)return true;if((!a&&b)||(a&&!b))return false;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual)return a.isEqual(b);if(_.isDate(a)&&_.isDate(b))return a.getTime()===b.getTime();if(_.isNaN(a)&&_.isNaN(b))return false;if(_.isRegExp(a)&&_.isRegExp(b))
return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(atype!=='object')return false;if(a.length&&(a.length!==b.length))return false;var aKeys=_.keys(a),bKeys=_.keys(b);if(aKeys.length!=bKeys.length)return false;for(var key in a)if(!(key in b)||!_.isEqual(a[key],b[key]))return false;return true;};_.isEmpty=function(obj){if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(hasOwnProperty.call(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]';};_.isArguments=function(obj){return!!(obj&&hasOwnProperty.call(obj,'callee'));};_.isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply);};_.isString=function(obj){return!!(obj===''||(obj&&obj.charCodeAt&&obj.substr));};_.isNumber=function(obj){return!!(obj===0||(obj&&obj.toExponential&&obj.toFixed));};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false;};_.isDate=function(obj){return!!(obj&&obj.getTimezoneOffset&&obj.setUTCFullYear);};_.isRegExp=function(obj){return!!(obj&&obj.test&&obj.exec&&(obj.ignoreCase||obj.ignoreCase===false));};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};_.template=function(str,data){var c=_.templateSettings;var tmpl='var __p=[],print=function(){__p.push.apply(__p,arguments);};'+'with(obj||{}){__p.push(\''+
str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'";}).replace(c.evaluate||null,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g,' ')+"__p.push('";}).replace(/\r/g,'\\r').replace(/\n/g,'\\n').replace(/\t/g,'\\t')
+"');}return __p.join('');";var func=new Function('obj',tmpl);return data?func(data):func;};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){method.apply(this._wrapped,arguments);return result(this._wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};})();(function($){var native_support=('placeholder'in document.createElement('input'));$.fn.placeholder=function(command){if(!native_support){if(command){switch(command){case'clear':this.each(function(){var el=$(this)
if(el.data('isEmpty')||el.val()==el.attr('placeholder')){el.val('');}});break;}
return this;}
this.each(function(){if(!$(this).data('gotPlaceholder')){$(this).focus(function(){var el=$(this);if(el.data('isEmpty')){el.val('').removeClass('placeholder');}}).blur(function(){var el=$(this);if(el.data('isEmpty')||!el.val().length){el.val(el.attr('placeholder')).addClass('placeholder');}}).keyup(function(){var el=$(this);el.data('isEmpty',(el.val().length==0));}).data('gotPlaceholder',true);if(!$(this).val().length||$(this).val()==$(this).attr('placeholder')){$(this).val($(this).attr('placeholder')).addClass('placeholder').data('isEmpty',true);}}});}
return this;}})(jQuery);function escapeHtml(text){return text.replace(/[&<>"'`]/g,function(chr){return'&#'+chr.charCodeAt(0)+';';});}
var Anathief=function(){var gd;var sock;var isGameOver=false,votedDone=false;var connected=false;var players={};var next_serial=1;var msgResponseCallbacks={};function log(x){if(typeof console=="object")
console.log(x);}
function ssend(type,data,onresponse){var serial=next_serial++;if(onresponse){msgResponseCallbacks[serial]=onresponse;}
var out=JSON.stringify(_.extend({_t:type,_s:serial},data));log(">> "+out);sock.send(out);}
function init(_gd){gd=_gd;initConn();initDefinitions();initChat();initGameInterface();initInstructionsInterface();initInviteInterface();initPromptLogin();initBotControl();}
function initConn(){disableConnUi();addMessage(null,'Connecting...');sock=new io.connect(gd.sio);sock.on('connect',onConnect);sock.on('disconnect',onDisconnect);sock.on('reconnect',onReconnect);sock.on('message',onMessage);}
function disableConnUi(){$('.conn-ui').attr('disabled','disabled');}
function enableConnUi(){$('.conn-ui').removeAttr('disabled');}
function disablePlayUi(){$('.play-ui').attr('disabled','disabled');$(document.body).addClass('game-over');}
function enablePlayUi(){$('.play-ui').removeAttr('disabled');$(document.body).removeClass('game-over');}
function onConnect(){addMessage(null,'Logging in...');ssend('identify',{id_token:gd.idToken},function(data){if(data.ok){addMessage(null,'Connected.');enableConnUi();log('Connected');connected=true;}else{addMessage(null,'Error logging in: '+data.message+'.');}});}
function onDisconnect(){addMessage(null,'Disconnected.');disableConnUi();log('Disconnected');connected=false;}
function onReconnect(){addMessage(null,'Reconnecting...');log('Reconnecting');}
function onMessage(data_){log("<< "+data_);data=JSON.parse(data_);switch(data._t){case'response':if(data._s in msgResponseCallbacks){msgResponseCallbacks[data._s](data);delete msgResponseCallbacks[data._s];}
break;case'chatted':addMessage(data.from,_.template('says: <%= escapeHtml(message) %>',data),'chatted',true);break;case'flipped':addMessage(data.from,_.template('flipped <%= escapeHtml(letter) %>.',data),'flipped');break;case'claimed':data.desc=describeMove(data);addMessage(data.from,_.template('claimed <%= escapeHtml(word) %><%= desc %>.',data),'claimed',true);break;case'claim_failed':data.desc=describeMove(data);data.failReason=failReason(data);addMessage(data.from,_.template('tried to claim <%= escapeHtml(word) %><%= desc %>, but <%= failReason %>.',data),'claim_failed');break;case'voted_done':addMessage(data.from,_.template('<%= vote ? "voted to end the game." : "canceled vote to end game." %>'+'<br /><%= num_voted %> votes / <%= num_needed %> needed'+'<% if (game_ending) { %><br /><strong>Game Over!</strong><% } %>',data),'voted_done');if(data.game_ending){var props={};_.each(data.ranks,function(r){var ordinal=r.ordinal;if(!(ordinal in props))
props[ordinal]=[];props[ordinal].push(r.name+", with "+r.score+" letters");});for(var ord in props){props[ord]=props[ord].join('; ');}
publishGame({title_line:"I just played a game of Anagram Thief!",properties:props});}
break;case'restarted':addMessage(data.from,'restarted the game.','restarted');break;case'joined':addMessage(data.from,'joined the game.','player-joined');break;case'left':addMessage(data.from,'left the game.','player-left');break;case'update':processUpdate(data);break;case'definitions':newdef=$('<div class="active-defn" />').html(JST.definitions(data));$('#definition').children().removeClass('active-defn');$('#definition').append(newdef);break;}}
function initDefinitions(){$('#prev-defn').click(function(){switchDefn('prev');return false;});$('#next-defn').click(function(){switchDefn('next');return false;});}
function switchDefn(whichWay){cur=$('.active-defn');next=cur[whichWay]();if(next.size()){cur.removeClass('active-defn');next.addClass('active-defn');}}
function initChat(){$('#chat').keydown(function(e){if(e.keyCode==13){var msg=$('#chat').val();if(msg){ssend('chat',{message:msg});}else{$('#claimword').focus();}
$('#chat').val('');return false;}else if(e.keyCode==27){$('#chat').val('');$('#claimword').focus();return false;}});$('#message-area').click(function(){$('#chat').focus();});}
function initGameInterface(){function flipChar(){$('#flip-btn').attr('disabled','disabled');setTimeout(function(){if(connected&&!isGameOver)
$('#flip-btn').removeAttr('disabled');},1000);ssend('flip',{},function(data){if(data.message){addMessage(null,data.message);}});$('#claimword').focus();}
function submitClaim(){var word=$('#claimword').val();if(!word){flipChar();return;}
ssend('claim',{word:word});$('#claimword').val('');}
$('#flip-btn').click(function(){flipChar();return false;});$('#claimword').keydown(function(e){if(e.keyCode==32){$('#chat').focus();return false;}else if(e.keyCode==27){$('#claimword').val('');return false;}else if(e.keyCode==13){submitClaim();return false;}});$('#claim-btn').click(function(){submitClaim();return false;});function voteBtn(vote){votedDone=vote;ssend('vote_done',{vote:vote});updateDoneButton();}
$('#vote-done-btn').click(function(){voteBtn(true);});$('#cancel-vote-btn').click(function(){voteBtn(false);});$('#restart-btn').click(function(){ssend('restart');});$('#refresh-btn').click(function(){refreshState();});}
function refreshState(){ssend('refresh',{},function(data){if(data.ok){processUpdate(data.update_data);}});}
function updateDoneButton(){if(isGameOver){$('#vote-done-btn').hide();$('#cancel-vote-btn').hide();}else if(votedDone){$('#vote-done-btn').hide();$('#cancel-vote-btn').show();}else{$('#vote-done-btn').show();$('#cancel-vote-btn').hide();}}
function processUpdate(data){players=data.players;updatePool(data);updatePlayers(data);updateGameOver(data);FB.Canvas.setSize();}
function updatePool(data){$('#pool-area').html(JST.tiles({tiles:data.pool,num_unseen:data.pool_remaining}));}
function updatePlayers(data){players=data.players;$('#player-area').empty();_.each(data.players_order,function(pid){$('#player-area').append(JST.player(_.extend({tiles_template:JST.tiles},players[pid])));});}
function updateGameOver(data){isGameOver=data.is_game_over;if(isGameOver){disablePlayUi();$('#game-over-area').html(JST.game_over(data));}else{enablePlayUi();$('#game-over-area').empty();}
votedDone=($.inArray(gd.userId,data.players_voted_done)!=-1);updateDoneButton();}
function publishGame(data){if(gd.isGuest){$('#prompt-login').show();}else{FB.ui({method:'feed',name:data.title_line,link:gd.urls.canvas,picture:gd.urls.fbPostImg,description:'Anagram Thief is an exciting multi-player game where you try to make words by stealing letters from your opponents.',properties:data.properties,message:''},function(response){});}}
function addMessage(from,message,msgclass,suppressHighlight){var msgId='message-'+Math.floor(Math.random()*2147483647);var li=$('<li id="'+msgId+'" />');if(from&&players[from]){var fromName=players[from].name;li.append($('<strong />').text(fromName)).append(' ');}
if(msgclass)li.addClass(msgclass);li.append(message);$('#messages').append(li);messageArea=$('#message-area');messageArea.scrollTop(messageArea[0].scrollHeight);if(!suppressHighlight)
$('#'+msgId).effect('highlight',{},3000);}
function initInstructionsInterface(){$('#show-instructions-link').click(function(){showInstructions();return false;});$('#hide-instructions-link').click(function(){hideInstructions();return false;});}
function hideInstructions(){$('#hide-instructions-link').hide();$('#show-instructions-link').show();$('#instructions-section').slideUp(null,setSize);}
function showInstructions(){$('#show-instructions-link').hide();$('#hide-instructions-link').show();$('#instructions-section').slideDown(null,setSize);}
function initInviteInterface(){$('#show-invites-link').click(function(){showInvites();return false;});$('#hide-invites-link').click(function(){hideInvites();return false;});$('#invite-url').focus(function(){this.select();});$('#invite-url').select(function(){this.select();});$('#invite-url').mouseover(function(){this.focus();this.select();});}
function hideInvites(){$('#hide-invites-link').hide();$('#show-invites-link').show();$('#invites-section').slideUp(null,function(){$('#invites-section').hide();setSize();});}
function showInvites(){$('#show-invites-link').hide();$('#hide-invites-link').show();$('#invites-section').slideDown(null,setSize);}
function initPromptLogin(){$('#hide-prompt-login').click(function(){$('#prompt-login').hide();return false;});}
function initBotControl(){$('#bot-btn').click(function(){$.post(gd.urls.addBot,{game_id:gd.gameId,level:$('#robot-level').val()});return false;});$('#nobot-btn').click(function(){$.post(gd.urls.removeBot,{game_id:gd.gameId});return false;});}
function removeBot(id){$.post(gd.urls.removeBot,{game_id:gd.gameId,bot_id:id});return false;}
function setSize(){FB.Canvas.setSize({height:document.documentElement.scrollHeight+30});}
function describeMove(data){var desc='';if(data.words_stolen&&data.words_stolen.length){desc+='stealing '+data.words_stolen.join(', ');}
if(data.pool_used&&data.pool_used.length){desc+=(data.words_stolen.length?' +':'taking');desc+=' '+data.pool_used.join(', ');}
if(desc.length)return' by '+desc;return'';}
function failReason(data){switch(data.cause){case'word_steal_shares_root':return'they share the common root '+data.shared_roots.join(', ');case'word_steal_not_extended':return"that would be stealing without extending";case'word_too_short':return"it's too short";case'word_not_in_dict':return"it's not in the dictionary";case'word_not_available':return"it's not on the board";default:return data.cause;}}
return{init:init,hideInvites:hideInvites,showInvites:showInvites,setSize:setSize,removeBot:removeBot,};}();$(document).ready(function(){$('[placeholder]').placeholder();});if(top.location.href==window.location.href)
$(document.body).addClass('standalone');